package library.management.system;

import java.awt.*;
import javax.swing.*;
import javax.swing.border.*;
import java.awt.event.*;
import java.sql.*;
import java.util.*;

public class AddBook extends JFrame implements ActionListener
{
    private JPanel contentPane;
    private JTextField t1,t2,t4,t5,t6,t7;
    private JButton b1,b2;
    JComboBox comboBox;
    int flag=0;
    
    public static void main(String[] args)
    {
	new AddBook().setVisible(true);
    }

    public void random()
    {
        //used to generate a random number for BookID
        Random rd = new Random();//This class is present in util package
	t1.setText("" + rd.nextInt(100000 + 1));//setting the text field to that random number
        //setting the starting seed to 100000
    }
    public AddBook()//Constructor
    {
        super("Add Book");
        setLocation(80,100);
        setBounds(600,200,438,442);
	contentPane = new JPanel();
	setContentPane(contentPane);
	contentPane.setLayout(null);

	JLabel l1=new JLabel("Book Name");
	l1.setForeground(Color.BLACK);
	l1.setFont(new Font("TimesRoman", Font.BOLD, 14));
	l1.setBounds(73,97,90,22);
	contentPane.add(l1);

	JLabel l3=new JLabel("Publisher");
	l3.setForeground(Color.BLACK);
	l3.setFont(new Font("TimesRoman", Font.BOLD, 14));
	l3.setBounds(73,133,90,22);
	contentPane.add(l3);

	JLabel l4=new JLabel("Price");
	l4.setForeground(Color.BLACK);
	l4.setFont(new Font("TimesRoman", Font.BOLD, 14));
	l4.setBounds(73,205,90,22);
	contentPane.add(l4);

	JLabel l5=new JLabel("Pages");
	l5.setForeground(Color.BLACK);
	l5.setFont(new Font("TimesRoman", Font.BOLD, 14));
	l5.setBounds(73,241,90,22);
	contentPane.add(l5);

	JLabel l6=new JLabel("Book ID");
	l6.setForeground(Color.BLACK);
	l6.setFont(new Font("TimesRoman", Font.BOLD, 14));
	l6.setBounds(73,61,90,22);
	contentPane.add(l6);

	JLabel l7=new JLabel("Edition");
	l7.setForeground(Color.BLACK);
	l7.setFont(new Font("TimeRoman", Font.BOLD, 14));
	l7.setBounds(73,169,90,22);
	contentPane.add(l7);
        
        JLabel l8=new JLabel("Copies");
	l8.setForeground(Color.BLACK);
	l8.setFont(new Font("TimesRoman", Font.BOLD, 14));
	l8.setBounds(73,278,90,22);
	contentPane.add(l8);

	t1=new JTextField();
        t1.setEditable(false);//the book id is generated by the compiler it cant be changed
	t1.setForeground(Color.BLACK);
	t1.setFont(new Font("TimesRoman", Font.BOLD, 14));
	t1.setBounds(169,64,198,20);
	contentPane.add(t1);
	t1.setColumns(10);

	t2=new JTextField();
	t2.setForeground(Color.BLACK);
	t2.setFont(new Font("TimesRoman", Font.BOLD, 14));
	t2.setColumns(10);
	t2.setBounds(169,100,198,20);
	contentPane.add(t2);

	t4=new JTextField();
	t4.setForeground(Color.BLACK);
	t4.setFont(new Font("TimesRoman", Font.BOLD, 14));
	t4.setColumns(10);
	t4.setBounds(169,136,198,20);
	contentPane.add(t4);

        t5=new JTextField();
	t5.setForeground(Color.BLACK);
	t5.setFont(new Font("TimesRoman", Font.BOLD, 14));
	t5.setColumns(10);
	t5.setBounds(169, 208, 198, 20);
	contentPane.add(t5);

	t6=new JTextField();
	t6.setForeground(Color.BLACK);
	t6.setFont(new Font("TimesRoman", Font.BOLD, 14));
	t6.setColumns(10);
	t6.setBounds(169,244,198,20);
	contentPane.add(t6);
        
        t7=new JTextField();
	t7.setForeground(Color.BLACK);
	t7.setFont(new Font("TimesRoman", Font.BOLD, 14));
	t7.setColumns(10);
	t7.setBounds(169,278,198,20);
	contentPane.add(t7);
  
        //creating drop down menu for book edition using a combo box
	comboBox=new JComboBox();
	comboBox.setModel(new DefaultComboBoxModel(new String[] { "1", "2", "3", "4", "5", "6", "7", "8", "9","10" }));
	comboBox.setBounds(169,172,198,20);
	contentPane.add(comboBox);

        b1 = new JButton("DONE");
	b1.addActionListener(this);
	b1.setBorder(new CompoundBorder(new LineBorder(Color.BLACK), null));
        b1.setFont(new Font("TimesRoman", Font.BOLD, 16));
	b1.setBounds(80, 310, 100, 33);
        b1.setBackground(Color.CYAN);
        b1.setForeground(Color.BLACK);
	contentPane.add(b1);

	b2 = new JButton("BACK");
	b2.addActionListener(this);
	b2.setBorder(new CompoundBorder(new LineBorder(Color.BLACK), null));
	b2.setFont(new Font("TimesRoman", Font.BOLD, 16));
	b2.setBounds(252,310,100,33);
        b2.setBackground(Color.CYAN);
        b2.setForeground(Color.BLACK);
	contentPane.add(b2);

	JPanel panel = new JPanel();
	TitledBorder tb=new TitledBorder(new LineBorder(Color.BLACK,3),"ADD BOOK",TitledBorder.CENTER, TitledBorder.TOP,null, Color.CYAN);
	panel.setBorder(tb);
        tb.setTitleFont(new Font("TimesRoman", Font.BOLD, 20));//setting the title's font size
	panel.setBounds(12, 16, 398, 354);
	contentPane.add(panel);
        
        panel.setBackground(Color.WHITE);
        contentPane.setBackground(Color.WHITE);
	
          random();
    }
    
    public void actionPerformed(ActionEvent ae)
    {
        try
        {
            conn con = new conn();
            if(ae.getSource()==b1)//checking if the button clicked is add button
            {
                //if the book name and edition are same we are going to say that the bokk is already added
		String sql2 = "select * from book where book_name=? and edition=?";
                PreparedStatement st2 = con.c.prepareStatement(sql2);
                st2.setString(1, t2.getText());
                st2.setString(2, (String) comboBox.getSelectedItem());
                //this method replaces the parameter on index 1 with text obtained from TextField
                ResultSet rs = st2.executeQuery();//executes the query
                //data in the mysql DB is matched with data in the tables
                if (rs.next()) 
                {//checks the table row by row
                  JOptionPane.showMessageDialog(null, "Book already Added!!!");  
                  flag=1;
                  String sql3 = "update book set copies=? where book_name=? and edition=?";
		  PreparedStatement st3 = con.c.prepareStatement(sql3);
                  
		  st3.setString(1, String.valueOf(Integer.parseInt(t7.getText())+rs.getInt("copies")));
                  st3.setString(2, t2.getText());
                  st3.setString(3, (String) comboBox.getSelectedItem());
                  if(st3.executeUpdate()>0)
                    JOptionPane.showMessageDialog(null,"Copies Updated");
                 } 
                else if(flag!=1)
                {
                String sql = "insert into book(book_id, book_name, publisher, edition, price, pages,copies) values(?, ?, ?, ?, ?, ?,?)";
		PreparedStatement st = con.c.prepareStatement(sql);
		st.setString(1, t1.getText());
		st.setString(2, t2.getText());
		st.setString(3, t4.getText());
		st.setString(4, (String) comboBox.getSelectedItem());
		st.setString(5, t5.getText());
		st.setString(6, t6.getText());
                st.setString(7, t7.getText());
		if(st.executeUpdate()>0)
                    JOptionPane.showMessageDialog(null,"Book Added!");
		else
                    JOptionPane.showMessageDialog(null, "Book NOT Added!!!");
              
              }
                random();
                t2.setText("");
                t4.setText("");
                t5.setText("");
                t6.setText("");
                t7.setText("");
            }
            if(ae.getSource()==b2)//checking if the button clicked is back button
            {
                this.setVisible(false);
		new Home().setVisible(true);
            }
            con.c.close();
        }
        catch(Exception e)
        {
         e.printStackTrace();
        }
    }
}